<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ç°¡å–®è¡¨å–®</title>
</head>
<body>
  <h2>æ–°å¢è¨‚å–®</h2>
  
  <label for="pname">å•†å“ï¼š</label>
  <select id="pname"></select>

  <label for="cname">æœƒå“¡ï¼š</label>
  <select id="cname"></select>

  <label for="sname">é‹é€è€…ï¼š</label>
  <select id="sname"></select>

  <!-- ğŸ‘‡ æ•¸é‡æ¬„ä½å·²ç§»é™¤ -->
  <!-- <label for="num">æ•¸é‡ï¼š</label>
  <input type="text" id="num"> -->

  <button onclick="insertpost()">æ–°å¢</button>

  <script>
    const apiCustomer = 'http://localhost:8000/api/1/member';
    const apiProduct = 'http://localhost:8000/api/1/product2';
    const apiShipper = 'http://localhost:8000/api/1/employee';
    const cname = document.getElementById("cname");
    const pname = document.getElementById("pname");
    const sname = document.getElementById("sname");

    async function cnameAdd() {
      try {
        const resp = await fetch(apiCustomer);
        const data = await resp.json();

        const defaultOption = document.createElement("option");
        defaultOption.value = "";
        defaultOption.textContent = "-- è«‹é¸æ“‡æœƒå“¡ --";
        defaultOption.disabled = true;
        defaultOption.selected = true;
        cname.append(defaultOption);

        data.forEach(row => {
          const id = row["idmember"];
          const name = row["membername"];
          const op = document.createElement("option");

          op.value = id;
          op.textContent = `${id} - ${name}`;
          cname.append(op);
        });
      } catch (err) {
        console.error("å®¢æˆ¶è³‡æ–™è¼‰å…¥å¤±æ•—", err);
      }
    }

    async function pnameAdd() {
      try {
        const resp = await fetch(apiProduct);
        if (!resp.ok) throw new Error(`HTTP éŒ¯èª¤: ${resp.status}`);
        const data = await resp.json();
        if (!Array.isArray(data) || data.length === 0) return;

        const defaultOption = document.createElement("option");
        defaultOption.value = "";
        defaultOption.textContent = "-- è«‹é¸æ“‡å•†å“ --";
        defaultOption.disabled = true;
        defaultOption.selected = true;
        pname.append(defaultOption);

        data.forEach(row => {
          const id = row["idproduct2"];
          const distance = row["distance"];
          const weight = row["weight"];
          const price = row["price"];
          const op = document.createElement("option");

          op.value = id;
          op.textContent = `${id} - é•·åº¦: ${distance}, é‡é‡: ${weight}, åƒ¹æ ¼: ${price}`;
          pname.append(op);
        });
      } catch (err) {
        console.error("å•†å“è³‡æ–™è¼‰å…¥å¤±æ•—", err);
      }
    }

    async function snameAdd() {
      try {
        const resp = await fetch(apiShipper);
        const data = await resp.json();

        const defaultOption = document.createElement("option");
        defaultOption.value = "";
        defaultOption.textContent = "-- è«‹é¸æ“‡é‹é€è€… --";
        defaultOption.disabled = true;
        defaultOption.selected = true;
        sname.append(defaultOption);

        data.forEach(row => {
          const id = row["idemployee"];
          const name = row["employeeName"];
          const op = document.createElement("option");

          op.value = id;
          op.textContent = `${id} - ${name}`;
          sname.append(op);
        });
      } catch (err) {
        console.error("é‹é€è€…è³‡æ–™è¼‰å…¥å¤±æ•—", err);
      }
    }

    cnameAdd();
    pnameAdd();
    snameAdd();

    function insertpost() {
      const pnameValue = document.getElementById("pname").value;
      const cnameValue = document.getElementById("cname").value;
      const snameValue = document.getElementById("sname").value;

      if (pnameValue && cnameValue && snameValue) {
        const returnbody = JSON.stringify({
          table: "orders",
          pname: pnameValue,
          cname: cnameValue,
          sname: snameValue
        });

        console.log(returnbody);

        fetch('http://localhost:8000/api/2/insert', {
          method: 'POST',
          mode: 'cors',
          body: returnbody,
        });

        console.log("å®Œæˆfetch");
      } else {
        alert("è«‹è¼¸å…¥è³‡æ–™");
      }
    }
  </script>
</body>
</html>
